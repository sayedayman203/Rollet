(self.webpackChunkrollet_admin_panel=self.webpackChunkrollet_admin_panel||[]).push([[653],{5264:(t,e,s)=>{"use strict";s.r(e),s.d(e,{UserModule:()=>x});var n=s(1116),i=s(5141),r=s(4613),a=s(8619),o=s(7727),d=s(6599),u=s(9589),c=s(1225),p=s(2693);let l=(()=>{class t{constructor(t,e){this.http=t,this.router=e,this.user=new u.t}fetchUser(t){return this.http.get(`/api/dashboard/user/${t}`).pipe((0,o.K)(this.handleError),(0,d.b)(t=>{this.user.next(t)}))}addPoints({userName:t,points:e}){return this.http.post(`/api/dashboard/user/${t}/addPoints`,{points:e}).pipe((0,o.K)(this.handleError))}minusPoints({userName:t,points:e}){return this.http.post(`/api/dashboard/user/${t}/minusPoints`,{points:e}).pipe((0,o.K)(this.handleError))}takeGift(t){return this.http.post(`/api/dashboard/user/${t}/gift`,{}).pipe((0,o.K)(this.handleError))}changeStatus(t,e){return this.http.put(`/api/dashboard/user/${t}/status`,{status:e}).pipe((0,o.K)(this.handleError))}handleError(t){let e="\u0639\u0630\u0631\u0627\u060c \u062d\u062f\u062b \u062e\u0637\u0623 \u0645\u0627.";switch(t.error.message){case"USER_NOTFOUNT":e="\u0644\u0627 \u064a\u0648\u062c\u062f \u0645\u0633\u062a\u062e\u062f\u0645 \u0628\u0647\u0630\u0627 \u0627\u0644\u0627\u0633\u0645.";break;case"NUMBER_MIN_0":e="\u0628\u0631\u062c\u0627\u0621 \u0627\u062f\u062e\u0627\u0644 \u0639\u062f\u062f \u0635\u062d\u064a\u062d.";break;case"NEGATIVE_POINTS":e="\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0644\u0627 \u064a\u0645\u062a\u0644\u0643 \u0645\u0627 \u064a\u0643\u0641\u064a \u0645\u0646 \u0627\u0644\u0646\u0642\u0627\u0637."}return(0,c._)(e)}}return t.\u0275fac=function(e){return new(e||t)(a.LFG(p.eN),a.LFG(i.F0))},t.\u0275prov=a.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var h=s(9339),g=s(3851),Z=s(1862),m=s(1742),b=s(6073),f=s(1462);const v=function(t,e){return{"btn-primary":t,"btn-danger":e}};let T=(()=>{class t{constructor(t,e){this.userService=t,this.alertService=e,this.add=!0,this.pointsChanged=new a.vpe}ngOnInit(){}onSubmit(t){if(t.invalid)return;const{points:e}=t.value;let s;s=this.add?this.userService.addPoints({userName:this.userName,points:e}):this.userService.minusPoints({userName:this.userName,points:e}),s.subscribe(()=>{const t=new r.b("success","\u0639\u0645\u0644\u064a\u0629 \u0646\u0627\u062c\u062d\u0647",this.add?`\u062a\u0645 \u0627\u0636\u0627\u0641\u0629 ${e} \u0646\u0642\u0627\u0637 \u0644\u0644\u0645\u0633\u062a\u062e\u062f\u0645 ${this.userName}`:`\u062a\u0645 \u062e\u0635\u0645 ${e} \u0646\u0642\u0627\u0637 \u0644\u0644\u0645\u0633\u062a\u062e\u062f\u0645 ${this.userName}`);this.alertService.addAlert(t),this.pointsChanged.emit({add:this.add,points:e})},t=>{const e=new r.b("danger","\u0639\u0645\u0644\u064a\u0629 \u0641\u0627\u0634\u0644\u0629",t);this.alertService.addAlert(e)})}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(l),a.Y36(g.c))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-edit-points"]],inputs:{add:"add",userName:"userName"},outputs:{pointsChanged:"pointsChanged"},decls:17,vars:7,consts:[[1,"modal","fade",3,"id"],[1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable","modal-lg"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],[1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn-close"],[1,"modal-body"],[3,"ngSubmit"],["f","ngForm"],[1,"form-group"],["for","title"],["type","number","name","points","ngModel","","required","","min","0",1,"form-control"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn",3,"ngClass","click"]],template:function(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div",0),a.TgZ(1,"div",1),a.TgZ(2,"div",2),a.TgZ(3,"div",3),a.TgZ(4,"h5",4),a._uU(5),a.qZA(),a._UZ(6,"button",5),a.qZA(),a.TgZ(7,"div",6),a.TgZ(8,"form",7,8),a.NdJ("ngSubmit",function(){a.CHM(t);const s=a.MAs(9);return e.onSubmit(s)}),a.TgZ(10,"div",9),a.TgZ(11,"label",10),a._uU(12,"\u0639\u062f\u062f \u0627\u0644\u0646\u0642\u0627\u0637"),a.qZA(),a._UZ(13,"input",11),a.qZA(),a.qZA(),a.qZA(),a.TgZ(14,"div",12),a.TgZ(15,"button",13),a.NdJ("click",function(){a.CHM(t);const s=a.MAs(9);return e.onSubmit(s)}),a._uU(16),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA()}2&t&&(a.Q6J("id",e.add?"addPointsModal":"minusPointsModal"),a.xp6(5),a.hij("",e.add?"\u0627\u0636\u0627\u0641\u0629":"\u0633\u062d\u0628"," \u0646\u0642\u0627\u0637"),a.xp6(10),a.Q6J("ngClass",a.WLB(4,v,e.add,!e.add)),a.xp6(1),a.hij(" ",e.add?"\u0627\u0636\u0627\u0641\u0629":"\u0633\u062d\u0628"," "))},directives:[f._Y,f.JL,f.F,f.wV,f.qQ,f.Fj,f.JJ,f.On,f.Q7,n.mk],styles:[""]}),t})();function A(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div",12),a.TgZ(1,"button",25),a.NdJ("click",function(){return a.CHM(t),a.oxw().onTakeGift()}),a._uU(2," \u0627\u0644\u0647\u062f\u064a\u0629 \u0627\u0644\u064a\u0648\u0645\u064a\u0629 "),a.qZA(),a.qZA()}}function q(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",26),a.NdJ("click",function(){return a.CHM(t),a.oxw().onChangeUserStatus("deactive")}),a._uU(1," \u0627\u064a\u0642\u0627\u0641 \u0645\u0624\u0642\u062a "),a.qZA()}}function N(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",27),a.NdJ("click",function(){return a.CHM(t),a.oxw().onChangeUserStatus("active")}),a._uU(1," \u062a\u0641\u0639\u064a\u0644 "),a.qZA()}}let w=(()=>{class t{constructor(t,e,s,n){this.userService=t,this.transactionsService=e,this.alertService=s,this.router=n,this.points=0}ngOnInit(){this.userService.user.subscribe(t=>{this.user=t.user,this.points=t.user.points,this.transactions=t.transactions;const e=new Date((null==t?void 0:t.user.lastGift)||0),s=(new Date).setHours(0,0,0,0);this.dailyGift=Math.floor(Math.abs((s-e)/864e5))>0})}onPointsChange({add:t,points:e}){this.onGoTo(1),t?this.points+=e:this.points-=e}onTakeGift(){this.userService.takeGift(this.user.userName).subscribe(()=>{const t=new r.b("success","\u0639\u0645\u0644\u064a\u0629 \u0646\u0627\u062c\u062d\u0647",`\u062a\u0645 \u0627\u0633\u062a\u0644\u0627\u0645 \u0627\u0644\u0647\u062f\u064a\u0629 \u0627\u0644\u064a\u0648\u0645\u064a\u0629 \u0644\u0644\u0645\u0633\u062a\u062e\u062f\u0645 ${this.user.userName}`);this.alertService.addAlert(t),this.points+=1,this.dailyGift=!1},t=>{const e=new r.b("danger","\u0639\u0645\u0644\u064a\u0629 \u0641\u0627\u0634\u0644\u0629",t);this.alertService.addAlert(e)})}onGoTo(t){this.transactionsService.fetchTransactions(t,void 0,this.user.userName).subscribe(t=>{this.transactions=t},t=>{const e=new r.b("danger","\u0639\u0645\u0644\u064a\u0629 \u0641\u0627\u0634\u0644\u0629",t);this.alertService.addAlert(e)})}onChangeUserStatus(t){this.userService.changeStatus(this.user.userName,t).subscribe(()=>{"deleted"===t&&this.router.navigate(["/dashboard"]),this.user.status=t},t=>{const e=new r.b("danger","\u0639\u0645\u0644\u064a\u0629 \u0641\u0627\u0634\u0644\u0629",t);this.alertService.addAlert(e)})}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(l),a.Y36(h.v),a.Y36(g.c),a.Y36(i.F0))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-user"]],decls:53,vars:15,consts:[[1,"d-flex","justify-content-between","flex-wrap","flex-md-nowrap","align-items-center","pt-3","pb-2","mb-3","border-bottom"],[1,"h2"],["id","profile",1,"mt-4"],[1,"container"],[1,"row"],[1,"col-md-9"],[1,"card"],[1,"card-header","d-flex","justify-content-between"],[1,"card-body"],[1,"name"],[1,"lead"],[1,"points"],[1,"col-md-3"],["href","#","data-bs-toggle","modal","data-bs-target","#addPointsModal",1,"btn","btn-primary","w-100"],["name","plus"],["href","#","data-bs-toggle","modal","data-bs-target","#minusPointsModal",1,"btn","btn-danger","w-100"],["name","minus"],["class","col-md-3",4,"ngIf"],[1,"d-block","img-fluid","mb-3",3,"src"],["class","btn btn-warning d-block w-100 my-2",3,"click",4,"ngIf"],["class","btn btn-success d-block w-100 my-2",3,"click",4,"ngIf"],[1,"btn","btn-danger","d-block","w-100",3,"click"],[3,"transactions"],[3,"pagination","goTo"],[3,"add","userName","pointsChanged"],[1,"btn","btn-success","w-100",3,"click"],[1,"btn","btn-warning","d-block","w-100","my-2",3,"click"],[1,"btn","btn-success","d-block","w-100","my-2",3,"click"]],template:function(t,e){1&t&&(a.TgZ(0,"div",0),a.TgZ(1,"h1",1),a._uU(2),a.qZA(),a.qZA(),a.TgZ(3,"section",2),a.TgZ(4,"div",3),a.TgZ(5,"div",4),a.TgZ(6,"div",5),a.TgZ(7,"div",6),a.TgZ(8,"div",7),a.TgZ(9,"h4"),a._uU(10),a.qZA(),a.qZA(),a.TgZ(11,"div",8),a.TgZ(12,"div",9),a.TgZ(13,"p",10),a._uU(14," \u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0627\u0648\u0644 : "),a.TgZ(15,"span"),a._uU(16),a.qZA(),a.qZA(),a.qZA(),a.TgZ(17,"div",9),a.TgZ(18,"p",10),a._uU(19," \u0627\u0633\u0645 \u0627\u0644\u0639\u0627\u0626\u0644\u0629 : "),a.TgZ(20,"span"),a._uU(21),a.qZA(),a.qZA(),a.qZA(),a.TgZ(22,"div",11),a.TgZ(23,"p",10),a._uU(24," \u0639\u062f\u062f \u0627\u0644\u0646\u0642\u0627\u0637 : "),a.TgZ(25,"span"),a._uU(26),a.qZA(),a.qZA(),a.qZA(),a.TgZ(27,"div",4),a.TgZ(28,"div",12),a.TgZ(29,"a",13),a._UZ(30,"i-feather",14),a._uU(31," \u0627\u0636\u0627\u0641\u0629 \u0646\u0642\u0627\u0637"),a.qZA(),a.qZA(),a.TgZ(32,"div",12),a.TgZ(33,"a",15),a._UZ(34,"i-feather",16),a._uU(35," \u0633\u062d\u0628 \u0646\u0642\u0627\u0637"),a.qZA(),a.qZA(),a.YNc(36,A,3,0,"div",17),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(37,"div",12),a.TgZ(38,"h3"),a._uU(39,"\u0635\u0648\u0631\u0629"),a.qZA(),a._UZ(40,"img",18),a.YNc(41,q,2,0,"button",19),a.YNc(42,N,2,0,"button",20),a.TgZ(43,"button",21),a.NdJ("click",function(){return e.onChangeUserStatus("deleted")}),a._uU(44," \u062d\u0630\u0641 "),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(45,"section"),a.TgZ(46,"div",0),a.TgZ(47,"h1",1),a._uU(48,"\u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645"),a.qZA(),a.qZA(),a._UZ(49,"app-transactions-table",22),a.TgZ(50,"app-pagination",23),a.NdJ("goTo",function(t){return e.onGoTo(t)}),a.qZA(),a.qZA(),a.TgZ(51,"app-edit-points",24),a.NdJ("pointsChanged",function(t){return e.onPointsChange(t)}),a.qZA(),a.TgZ(52,"app-edit-points",24),a.NdJ("pointsChanged",function(t){return e.onPointsChange(t)}),a.qZA()),2&t&&(a.xp6(2),a.hij("\u0645\u0633\u062a\u062e\u062f\u0645 \u0631\u0642\u0645 : ",e.user.userId,""),a.xp6(8),a.Oqu(e.user.userName),a.xp6(6),a.hij(" ",e.user.firstName,""),a.xp6(5),a.hij(" ",e.user.lastName,""),a.xp6(5),a.hij(" ",e.points,""),a.xp6(10),a.Q6J("ngIf",e.dailyGift),a.xp6(4),a.Q6J("src","/assets/img/"+(e.user.pic||"avatar.png"),a.LSH),a.xp6(1),a.Q6J("ngIf","active"===e.user.status),a.xp6(1),a.Q6J("ngIf","deactive"===e.user.status),a.xp6(7),a.Q6J("transactions",e.transactions.data),a.xp6(1),a.Q6J("pagination",e.transactions.pagination),a.xp6(1),a.Q6J("add",!0)("userName",e.user.userName),a.xp6(1),a.Q6J("add",!1)("userName",e.user.userName))},directives:[Z.uy,n.O5,m.k,b.Q,T],styles:[""]}),t})();const S=[{path:":userName",resolve:[(()=>{class t{constructor(t){this.userService=t}resolve(t,e){return this.userService.fetchUser(t.params.userName)}}return t.\u0275fac=function(e){return new(e||t)(a.LFG(l))},t.\u0275prov=a.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()],component:w}];let U=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[i.Bz.forChild(S)],i.Bz]}),t})();var _=s(5425),k=s(1661);let x=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[n.ez,U,f.u5,_.m,k.p]]}),t})()}}]);